<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Resume — Template 1 (ATS Optimized)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Resume generated by resume builder (ATS-optimized)"/>
  <style>
    html,
    body {
    margin: 0;
    padding: 0;
    font-family: Arial, Helvetica, sans-serif;
    color: #111;
    background: #f7f8fb;
}

.container {
    max-width: 760px;
    margin: 28px auto;
    padding: 22px;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 6px 22px rgba(20, 30, 60, 0.06);
}

header.site-header {
    display: flex;
    gap: 16px;
    align-items: center;
    margin-bottom: 8px;
}

header h1 {
    font-size: 1.6rem;
    margin: 0;
    font-weight: 700;
}

.contact {
    font-size: 0.95rem;
    color: #444;
    margin-top: 6px;
}

.section {
    margin-top: 16px;
    padding-top: 12px;
    border-top: 1px solid #eee;
}

h2.section-title {
    margin: 0 0 10px 0;
    font-size: 1rem;
    letter-spacing: 0.02em;
    color: #222;
}

article.entry {
    margin-bottom: 10px;
}

article.entry h3 {
    margin: 0;
    font-size: 0.98rem;
    font-weight: 700;
}

.meta-row {
    font-size: 0.9rem;
    color: #444;
    margin-top: 4px;
}

.desc {
    margin-top: 8px;
    white-space: pre-wrap;
    font-size: 0.95rem;
    color: #222;
}

.skills-list {
    font-size: 0.95rem;
    color: #222;
}

.no-data {
    color: #444;
    font-style: italic;
}

/* buttons */
.controls {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-bottom: 8px;
}

button.action {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid #d0d7ff;
    background: linear-gradient(#2b49b1, #1f3b82);
    color: #fff;
    cursor: pointer;
}

button.secondary {
    background: #fff;
    color: #1f3b82;
    border: 1px solid rgba(31, 59, 130, 0.12);
}

/* Print-friendly */
@media print {
    body {
        background: #fff;
    }

    .controls {
        display: none;
    }

    .container {
        box-shadow: none;
        border-radius: 0;
        padding: 12px;
    }
}

button:focus,
a:focus {
    outline: 3px solid rgba(43, 73, 177, 0.18); 
    outline-offset:2px; 
  }
  </style>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "",
    "url": "",
    "jobTitle": "",
    "description": ""
  }
  </script>
</head>
<body>
  <div class="container" role="main" aria-labelledby="resume-title">
    <div class="controls no-print" aria-hidden="false">
      <button id="btnEdit" class="secondary">Edit Details</button>
      <button id="btnDownloadTxt" class="action">Download Plain Text</button>
      <button id="btnPrint" class="action">Print / Save PDF</button>
    </div>

    <header class="site-header" role="banner">
      <div style="flex:1">
        <h1 id="resume-title">Your Name</h1>
        <div class="contact" id="contact_line">Email · Phone · Website</div>
      </div>
      <div aria-hidden="true" id="photo_wrap" style="display:none">
        <img id="tpl_profileImg" alt="Profile photo" style="width:88px;height:88px;border-radius:6px;object-fit:cover"/>
      </div>
    </header>

    <main>
      <!-- Summary / Objective (ATS-friendly label) -->
      <section id="section_summary" class="section" aria-labelledby="summary_title">
        <h2 id="summary_title" class="section-title">SUMMARY</h2>
        <div id="tpl_career" class="desc"></div>
      </section>

      <!-- Experience: Jobs + Internships + Projects (each as article.entry with h3) -->
      <section id="section_experience" class="section" aria-labelledby="experience_title">
        <h2 id="experience_title" class="section-title">EXPERIENCE</h2>
        <!-- Jobs -->
        <div id="tpl_jobs_container"></div>

        <!-- Internships (treated as experience when present) -->
        <div id="tpl_internships_container"></div>

        <!-- Projects (if relevant, shown under EXPERIENCE) -->
        <div id="tpl_projects_container"></div>

        <div id="experience_empty" class="no-data" style="display:none">No professional experience added.</div>
      </section>

      <!-- Education -->
      <section id="section_education" class="section" aria-labelledby="education_title">
        <h2 id="education_title" class="section-title">EDUCATION</h2>
        <div id="tpl_education_container"></div>
        <div id="education_empty" class="no-data" style="display:none">No education details added.</div>
      </section>

      <!-- Skills -->
      <section id="section_skills" class="section" aria-labelledby="skills_title">
        <h2 id="skills_title" class="section-title">SKILLS</h2>
        <div id="tpl_skills" class="skills-list"></div>
      </section>

      <!-- References (hidden if empty) -->
      <section id="section_references" class="section" aria-labelledby="references_title">
        <h2 id="references_title" class="section-title">REFERENCES</h2>
        <div id="tpl_references" class="desc"></div>
      </section>

      <section class="section" aria-labelledby="generated_title">
        <div id="tpl_savedAt" class="no-data"></div>
      </section>
    </main>
  </div>

  <script>

  const ks = {
    profile: 'rb_profile',
    name: 'rb_name',
    address: 'rb_address',
    phone: 'rb_phone',
    email: 'rb_email',
    about: 'rb_about',
    career: 'rb_career',
    educationArr: 'rb_education_arr',
    internshipsArr: 'rb_internships_arr',
    projectsArr: 'rb_projects_arr',
    jobsArr: 'rb_jobs_arr',
    skills: 'rb_skills',
    references: 'rb_references',
    website: 'rb_website',
    savedAt: 'rb_savedAt'
  };

  /* Simple helpers */
  const $ = id => document.getElementById(id);
  function get(k){ return localStorage.getItem(k) || ''; }
  function getArr(k){ try { const r = localStorage.getItem(k); return r ? JSON.parse(r) : []; } catch(e){ return []; } }
  function trimNonEmpty(s){ return s ? String(s).trim() : ''; }
  function hasRealData(obj){ return obj && Object.values(obj).some(v => v && String(v).trim() !== ''); }
  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

  /* Update JSON-LD Person block (helps modern parsers) */
  function updateJsonLd(person) {
    const existing = document.querySelector('script[type="application/ld+json"]');
    const data = {
      "@context":"https://schema.org",
      "@type":"Person",
      "name": person.name || "",
      "url": person.website || "",
      "jobTitle": person.jobTitle || "",
      "description": person.summary || ""
    };
    if (existing) existing.textContent = JSON.stringify(data);
  }

  function buildPlainText() {
    const lines = [];
    const name = trimNonEmpty(get(ks.name));
    if (name) lines.push(name);

    const contact = [trimNonEmpty(get(ks.email)), trimNonEmpty(get(ks.phone)), trimNonEmpty(get(ks.website))].filter(Boolean).join(' · ');
    if (contact) lines.push(contact);

    lines.push('');
    const summary = trimNonEmpty(get(ks.career)) || trimNonEmpty(get(ks.about));
    if (summary) {
      lines.push('SUMMARY');
      lines.push(summary);
      lines.push('');
    }

    // EXPERIENCE (jobs)
    const jobs = getArr(ks.jobsArr).filter(hasRealData);
    const interns = getArr(ks.internshipsArr).filter(hasRealData);
    const projects = getArr(ks.projectsArr).filter(hasRealData);
    if (jobs.length || interns.length || projects.length) {
      lines.push('EXPERIENCE');
      jobs.forEach(j => {
        const title = trimNonEmpty(j.title), comp = trimNonEmpty(j.company);
        lines.push(`${title}${comp ? ' — ' + comp : ''}`);
        if (j.start || j.end) lines.push(`${trimNonEmpty(j.start) || ''}${j.end ? ' — ' + trimNonEmpty(j.end) : ''}`);
        if (j.details) lines.push(trimNonEmpty(j.details));
        lines.push('');
      });
      interns.forEach(i => {
        const title = trimNonEmpty(i.title), comp = trimNonEmpty(i.company);
        lines.push(`${title}${comp ? ' — ' + comp : ''} (Internship)`);
        if (i.start || i.end) lines.push(`${trimNonEmpty(i.start) || ''}${i.end ? ' — ' + trimNonEmpty(i.end) : ''}`);
        if (i.details) lines.push(trimNonEmpty(i.details));
        lines.push('');
      });
      projects.forEach(p => {
        lines.push(`${trimNonEmpty(p.title)}${p.tech ? ' — ' + trimNonEmpty(p.tech) : ''} (Project)`);
        if (p.start || p.end) lines.push(`${trimNonEmpty(p.start) || ''}${p.end ? ' — ' + trimNonEmpty(p.end) : ''}`);
        if (p.details) lines.push(trimNonEmpty(p.details));
        lines.push('');
      });
    }

    // EDUCATION
    const edu = getArr(ks.educationArr).filter(hasRealData);
    if (edu.length) {
      lines.push('EDUCATION');
      edu.forEach(e => {
        lines.push(`${trimNonEmpty(e.course)}${e.institution ? ' — ' + trimNonEmpty(e.institution) : ''}`);
        if (e.start || e.end) lines.push(`${trimNonEmpty(e.start) || ''}${e.end ? ' — ' + trimNonEmpty(e.end) : ''}`);
        lines.push('');
      });
    }

    // SKILLS
    const skills = trimNonEmpty(get(ks.skills));
    if (skills) {
      lines.push('SKILLS');
      lines.push(skills);
      lines.push('');
    }

    // REFERENCES
    const refs = trimNonEmpty(get(ks.references));
    if (refs) {
      lines.push('REFERENCES');
      lines.push(refs);
      lines.push('');
    }

    // Generated at
    const savedAt = get(ks.savedAt);
    if (savedAt) lines.push('Generated: ' + new Date(savedAt).toLocaleString());

    return lines.join('\n').replace(/\n{3,}/g,'\n\n');
  }

  /* download helper */
  function downloadText(filename, content) {
    const blob = new Blob([content], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  /* Render the resume sections into the DOM (semantically) */
  document.addEventListener('DOMContentLoaded', () => {
    // NAME and contact
    const name = trimNonEmpty(get(ks.name));
    const email = trimNonEmpty(get(ks.email));
    const phone = trimNonEmpty(get(ks.phone));
    const website = trimNonEmpty(get(ks.website));
    const address = trimNonEmpty(get(ks.address));

    $('resume-title').textContent = name || 'Your Name';
    $('contact_line').textContent = [email, phone, website].filter(Boolean).join(' · ');
    if (address && !$('contact_line').textContent.includes(address)) {
      $('contact_line').textContent += ( $('contact_line').textContent ? ' · ' : '' ) + address;
    }

    // update JSON-LD
    updateJsonLd({ name, website, jobTitle: '', summary: trimNonEmpty(get(ks.career) || get(ks.about)) });

    // Profile image (optional)
    const profile = get(ks.profile);
    if (profile) {
      $('photo_wrap').style.display = '';
      $('tpl_profileImg').src = profile;
    } else {
      $('photo_wrap').style.display = 'none';
    }

    // SUMMARY (career or about)
    const summary = trimNonEmpty(get(ks.career)) || trimNonEmpty(get(ks.about));
    if (summary) {
      $('tpl_career').textContent = summary;
      $('section_summary').style.display = '';
    } else {
      $('section_summary').style.display = 'none';
    }

    /* EXPERIENCE: jobs, internships, projects */
    const jobs = getArr(ks.jobsArr).filter(hasRealData);
    const interns = getArr(ks.internshipsArr).filter(hasRealData);
    const projects = getArr(ks.projectsArr).filter(hasRealData);

    const jobsContainer = $('tpl_jobs_container');
    const internsContainer = $('tpl_internships_container');
    const projectsContainer = $('tpl_projects_container');

    jobsContainer.innerHTML = '';
    internsContainer.innerHTML = '';
    projectsContainer.innerHTML = '';

    // Helper to render an entry
    function renderEntry(container, obj, roleLabel) {
      const art = document.createElement('article');
      art.className = 'entry';
      // title + company
      const title = trimNonEmpty(obj.title || obj.course || obj.title);
      const company = trimNonEmpty(obj.company || obj.institution || '');
      const dateStr = (obj.start || '') + (obj.end ? (' — ' + obj.end) : '');
      art.innerHTML = `<h3>${escapeHtml(title || (obj.title || obj.course || ''))}${company ? ' — ' + escapeHtml(company) : ''}${roleLabel ? ' (' + escapeHtml(roleLabel) + ')' : ''}</h3>
                       <div class="meta-row">${escapeHtml(dateStr || '')}</div>
                       <div class="desc">${escapeHtml(obj.details || obj.description || '')}</div>`;
      container.appendChild(art);
    }

    // Render jobs
    if (jobs.length) {
      jobs.forEach(j => renderEntry(jobsContainer, j, ''));
    }
    // Render internships
    if (interns.length) {
      interns.forEach(i => renderEntry(internsContainer, i, 'Internship'));
    }
    // Render projects
    if (projects.length) {
      projects.forEach(p => renderEntry(projectsContainer, p, 'Project'));
    }

    const expEmpty = !jobs.length && !interns.length && !projects.length;
    $('experience_empty').style.display = expEmpty ? '' : 'none';
    $('section_experience').style.display = expEmpty ? '' : ''; // keep heading; you can hide section if preferred

    /* EDUCATION */
    const education = getArr(ks.educationArr).filter(hasRealData);
    const eduContainer = $('tpl_education_container');
    eduContainer.innerHTML = '';
    if (education.length) {
      education.forEach(e => renderEntry(eduContainer, { title: e.course, company: e.institution, start: e.start, end: e.end, details: '' }, ''));
      $('education_empty').style.display = 'none';
      $('section_education').style.display = '';
    } else {
      $('education_empty').style.display = '';
      $('section_education').style.display = ''; // keep heading visible; hide if you prefer
    }

    /* SKILLS */
    const skills = trimNonEmpty(get(ks.skills));
    if (skills) {
      $('tpl_skills').textContent = skills;
      $('section_skills').style.display = '';
    } else {
      $('tpl_skills').textContent = '';
      $('section_skills').style.display = 'none';
    }

    /* REFERENCES (hide if empty) */
    const refs = trimNonEmpty(get(ks.references));
    if (refs) {
      $('tpl_references').textContent = refs;
      $('section_references').style.display = '';
    } else {
      $('section_references').style.display = 'none';
    }

    /* Generated timestamp */
    const savedAt = get(ks.savedAt);
    if (savedAt) $('tpl_savedAt').textContent = 'Generated on: ' + new Date(savedAt).toLocaleString();

    /* Button wiring */
    $('btnEdit').addEventListener('click', () => { window.location.href = 'index1.html'; });
    $('btnPrint').addEventListener('click', () => { window.print(); });
    $('btnDownloadTxt').addEventListener('click', () => {
      const txt = buildPlainText();
      const filename = (trimNonEmpty(get(ks.name)) || 'resume').replace(/\s+/g,'_').toLowerCase() + '.txt';
      downloadText(filename, txt);
    });
  });
  </script>
</body>
</html>
